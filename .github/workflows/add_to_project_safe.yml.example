name: Auto Add Issue to Project (Safe)

on:
  issues:
    types: [opened]

jobs:
  add-to-project:
    runs-on: ubuntu-latest
    steps:
      - name: Check if token is set
        id: check_token
        run: |
          if [ -n "${{ secrets.ORG_PROJECTS_TOKEN }}" ]; then
            echo "token_exists=true" >> $GITHUB_OUTPUT
          else
            echo "token_exists=false" >> $GITHUB_OUTPUT
            echo "::warning::ORG_PROJECTS_TOKEN is not set. Skipping project automation."
          fi

      - name: Add to Project
        if: steps.check_token.outputs.token_exists == 'true'
        uses: actions/add-to-project@v0.5.0
        with:
          project-url: https://github.com/orgs/aptma-sHEWTeam/projects/3
          github-token: ${{ secrets.ORG_PROJECTS_TOKEN }}
